package com.j0rsa.cardsbuddy.translation.parser;

import com.j0rsa.cardsbuddy.translation.exceptions.NoSuchLanguageException;
import com.j0rsa.cardsbuddy.translation.model.Language;
import org.junit.Test;

import java.util.List;

import static com.j0rsa.cardsbuddy.DefaultData.readJson;
import static com.j0rsa.cardsbuddy.translation.parser.LanguageParser.parse;
import static org.assertj.core.api.Assertions.assertThat;

public class LanguageParserTest {

    @Test
    public void testParseLanguageFromWhenLanguageFromIsTheLastElement() throws Exception {
        String json = "[[[\"Prüfung\",\"exam\",null,null,1]],[[\"noun\",[\"Prüfung\",\"Examen\",\"Klausur\"],[[\"Prüfung\",[\"examination\",\"test\",\"audit\",\"testing\",\"check\",\"exam\"],null,0.35656098,\"die\",2],[\"Examen\",[\"exam\",\"examination\",\"finals\"],null,0.021413151,\"das\",3],[\"Klausur\",[\"exam\",\"enclosure\",\"cloister\",\"seclusion\",\"conclave\",\"paper\"],null,0.0089263292,\"die\",2]],\"exam\",1]],\"en\"]";
        testParseLanguageFrom(json);
    }

    @Test
    public void testParseLanguageFromWhenLanguageFromIsNotTheLastElement() throws Exception {
        String json = "[[[\"Prüfung\",\"test\",null,null,1],[null,null,null,\"test\"]],[[\"имя существительное\",[\"Test\",\"Prüfung\",\"Probe\",\"Versuch\",\"Untersuchung\",\"Kriterium\",\"Kontrolle\",\"Analyse\",\"Testfahrt\",\"Fahrprüfung\",\"Klassenarbeit\",\"Kurzarbeit\",\"Arbeit\"],[[\"Test\",[\"test\"],null,0.30498278,\"der\",1],[\"Prüfung\",[\"examination\",\"test\",\"audit\",\"testing\",\"check\",\"exam\"],null,0.061000392,\"die\",2],[\"Probe\",[\"sample\",\"test\",\"trial\",\"specimen\",\"rehearsal\",\"probation\"],null,0.0072854576,\"die\",2],[\"Versuch\",[\"attempt\",\"try\",\"test\",\"trial\",\"experiment\",\"effort\"],null,0.0068440544,\"der\",1],[\"Untersuchung\",[\"investigation\",\"examination\",\"study\",\"inquiry\",\"inspection\",\"test\"],null,0.0032329024,\"die\",2],[\"Kriterium\",[\"criterion\",\"circuit race\"],null,0.00069916417,\"das\",3],[\"Kontrolle\",[\"control\",\"check\",\"inspection\",\"checking\",\"supervision\",\"test\"],null,0.00059802679,\"die\",2],[\"Analyse\",[\"analysis\",\"test\"],null,0.00048809525,\"die\",2],[\"Testfahrt\",[\"test\"],null,0.00039219554,\"die\",2],[\"Fahrprüfung\",[\"test\"],null,0.00012535322,\"die\",2],[\"Klassenarbeit\",[\"test\"],null,3.4809334e-05,\"die\",2],[\"Kurzarbeit\",[\"test\"],null,5.4532984e-07,\"die\",2],[\"Arbeit\",[\"work\",\"labor\",\"job\",\"employment\",\"paper\",\"test\"],null,2.6995784e-07,\"die\",2]],\"test\",1],[\"глагол\",[\"testen\",\"prüfen\",\"erproben\",\"untersuchen\",\"probieren\",\"analysieren\",\"abfragen\"],[[\"testen\",[\"test\",\"try out\"],null,0.25682124],[\"prüfen\",[\"check\",\"examine\",\"consider\",\"test\",\"verify\",\"prove\"],null,0.063927859],[\"erproben\",[\"test\",\"prove\"],null,0.0003054422],[\"untersuchen\",[\"examine\",\"investigate\",\"study\",\"explore\",\"test\",\"probe\"],null,0.00013767359],[\"probieren\",[\"try\",\"taste\",\"sample\",\"try out\",\"test\",\"have a try\"],null,8.615393e-05],[\"analysieren\",[\"analyze\",\"construe\",\"psych\",\"analyse\"],null,2.0146097e-05],[\"abfragen\",[\"query\",\"interrogate\",\"call up\",\"test\",\"quiz\"],null,8.8011775e-06]],\"test\",2]],\"en\",null,null,[[\"test\",null,[[\"Prüfung\",1000,true,false],[\"Test\",1000,true,false],[\"testen\",1000,true,false]],[[0,4]],\"test\",0,0]],0.7647059,null,[[\"en\"],null,[0.7647059],[\"en\"]],null,null,[[\"имя существительное\",[[[\"trial\",\"experiment\",\"test case\",\"case study\",\"pilot study\",\"trial run\",\"tryout\",\"dry run\",\"check\",\"examination\",\"assessment\",\"evaluation\",\"appraisal\",\"investigation\",\"inspection\",\"analysis\",\"scrutiny\",\"study\",\"probe\",\"exploration\",\"screening\",\"workup\",\"assay\"],\"m_en_us1297943.001\"],[[\"exam\",\"examination\",\"quiz\"],\"m_en_us1297943.002\"],[[\"exam\",\"examination\"],\"\"],[[\"trial run\",\"trial\",\"tryout\"],\"\"],[[\"trial\"],\"\"],[[\"trial\",\"run\"],\"\"],[[\"mental test\"],\"\"]],\"test\"],[\"глагол\",[[[\"try out\",\"put to the test\",\"put through its paces\",\"experiment with\",\"pilot\",\"check\",\"examine\",\"assess\",\"evaluate\",\"appraise\",\"investigate\",\"analyze\",\"scrutinize\",\"study\",\"probe\",\"explore\",\"trial\",\"sample\",\"screen\",\"assay\"],\"m_en_us1297943.009\"],[[\"put a strain on\",\"strain\",\"tax\",\"try\",\"make demands on\",\"stretch\",\"challenge\"],\"m_en_us1297943.010\"],[[\"quiz\"],\"\"],[[\"screen\"],\"\"],[[\"essay\",\"try\",\"prove\",\"examine\",\"try out\"],\"\"]],\"test\"]],[[\"имя существительное\",[[\"a procedure intended to establish the quality, performance, or reliability of something, especially before it is taken into widespread use.\",\"m_en_us1297943.001\",\"no sparking was visible during the tests\"],[\"a movable hearth in a reverberating furnace, used for separating gold or silver from lead.\",\"m_en_us1297943.008\",\"When fully prepared, the test is allowed to dry, and is then placed in a furnace, constructed in all respects like a common reverberator)' furnace, except that a space is left open in the bed of it to receive the test, and that the width of the arch is much reduced.\"],[\"the shell or integument of some invertebrates and protozoans, especially the chalky shell of a foraminiferan or the tough outer layer of a tunicate.\",\"m_en_us1297944.001\",\"The tests of the shells are recrystallized, but the original ornamentation is preserved in very good detail.\"]],\"test\"],[\"глагол\",[[\"take measures to check the quality, performance, or reliability of (something), especially before putting it into widespread use or practice.\",\"m_en_us1297943.009\",\"this range has not been tested on animals\"]],\"test\"],[\"сокращение\",[[\"testator.\",\"m_en_us1297946.001\"]],\"test.\"]],[[[\"Their work aims to provide valid exposure data and to develop reliable methods to \\u003cb\\u003etest\\u003c/b\\u003e different types of mobile phones.\",null,null,null,3,\"m_en_us1297943.009\"],[\"On the other hand, there may be potential adverse psychological effects from a positive \\u003cb\\u003etest\\u003c/b\\u003e .\",null,null,null,3,\"m_en_us1297943.006\"],[\"And it is the daunting measuring stick to \\u003cb\\u003etest\\u003c/b\\u003e a rower's physical capabilities.\",null,null,null,3,\"m_en_us1297943.010\"],[\"One \\u003cb\\u003etest\\u003c/b\\u003e for the presence of silver ions in solution is to add chloride ions to the solution.\",null,null,null,3,\"m_en_us1297943.005\"],[\"They had had the element of surprise during the first attack, but now it was to be a real \\u003cb\\u003etest\\u003c/b\\u003e of strength.\",null,null,null,3,\"m_en_us1297943.003\"],[\"We've said in the pilot that if you have a positive \\u003cb\\u003etest\\u003c/b\\u003e , colonoscopy must be made available within four weeks.\",null,null,null,3,\"m_en_us1297943.006\"],[\"Her CV secured her an invite to an audition which would \\u003cb\\u003etest\\u003c/b\\u003e her flexibility, strength, floor work and aerial skills.\",null,null,null,3,\"m_en_us1297943.012\"],[\"It was an unequalled \\u003cb\\u003etest\\u003c/b\\u003e of courage, strength and endurance, technique being less important than character.\",null,null,null,3,\"m_en_us1297943.003\"],[\"Overall, he believes the game will be a \\u003cb\\u003etest\\u003c/b\\u003e for their reserve strength.\",null,null,null,3,\"m_en_us1297943.003\"],[\"such behavior would severely \\u003cb\\u003etest\\u003c/b\\u003e any marriage\",null,null,null,3,\"m_en_us1297943.010\"],[\"a positive \\u003cb\\u003etest\\u003c/b\\u003e for protein\",null,null,null,3,\"m_en_gb0854610.006\"],[\"Judging applicants must pass a written \\u003cb\\u003etest\\u003c/b\\u003e , demonstrating their knowledge of these rules.\",null,null,null,3,\"m_en_us1297943.002\"],[\"the exam will \\u003cb\\u003etest\\u003c/b\\u003e accuracy and neatness\",null,null,null,3,\"m_en_gb0854610.012\"],[\"a positive \\u003cb\\u003etest\\u003c/b\\u003e for protein\",null,null,null,3,\"m_en_us1297943.006\"],[\"a spelling \\u003cb\\u003etest\\u003c/b\\u003e\",null,null,null,3,\"m_en_us1297943.002\"],[\"Firstly the exam is to \\u003cb\\u003etest\\u003c/b\\u003e the teacher's ability not the students.\",null,null,null,3,\"m_en_us1297943.012\"],[\"The \\u003cb\\u003etest\\u003c/b\\u003e , when placed in position, forms the bed of the furnace, with the long diameter transversely.\",null,null,null,3,\"m_en_us1297943.008\"],[\"The new \\u003cb\\u003etest\\u003c/b\\u003e can identify the presence of anthrax in less than one hour instead of days.\",null,null,null,3,\"m_en_us1297943.005\"],[\"a \\u003cb\\u003etest\\u003c/b\\u003e for HIV\",null,null,null,3,\"m_en_us1297943.004\"],[\"After an ultrasound \\u003cb\\u003etest\\u003c/b\\u003e and a physical examination, ovarian cancer was diagnosed.\",null,null,null,3,\"m_en_us1297943.004\"],[\"When introducing a fresh cupel or \\u003cb\\u003etest\\u003c/b\\u003e , the fire must be low and heat must be applied with great caution, or otherwise the bone ash will split to pieces; and for the same reason the bone ash must be dried very gently.\",null,null,null,3,\"m_en_us1297943.008\"],[\"I answered the question, took a seat, wrote the \\u003cb\\u003etest\\u003c/b\\u003e , handed it in and left.\",null,null,null,3,\"m_en_us1297943.002\"],[\"a statutory \\u003cb\\u003etest\\u003c/b\\u003e of obscenity\",null,null,null,3,\"m_en_gb0854610.007\"],[\"It will be a \\u003cb\\u003etest\\u003c/b\\u003e of their strength, their mental toughness and their attitude.\",null,null,null,3,\"m_en_us1297943.003\"],[\"This young lad, since passing his \\u003cb\\u003etest\\u003c/b\\u003e , has written off two cars in self inflicted accidents.\",null,null,null,3,\"m_en_us1297943.002\"],[\"This week's What's Your Decision will really \\u003cb\\u003etest\\u003c/b\\u003e you and show you just how hard umpiring can be.\",null,null,null,3,\"m_en_us1297943.011\"],[\"Since the beast was invincible by arrow or club the contest was a \\u003cb\\u003etest\\u003c/b\\u003e of physical strength and endurance.\",null,null,null,3,\"m_en_us1297943.003\"],[\"To \\u003cb\\u003etest\\u003c/b\\u003e for overheating, touch your bare wrist to the barrel, near its end.\",null,null,null,3,\"m_en_us1297943.016\"],[\"Adrian had endured the ultimate \\u003cb\\u003etest\\u003c/b\\u003e of strength in a man, and here he was, alive and telling it all.\",null,null,null,3,\"m_en_us1297943.003\"],[\"To \\u003cb\\u003etest\\u003c/b\\u003e for taste, make a small patty of the meat mixture and sauté until cooked.\",null,null,null,3,\"m_en_us1297943.016\"]]],[[\"Test\",\"test tube\",\"blood test\",\"to test\",\"pregnancy test\",\"test report\",\"test drive\",\"driving test\",\"placement test\",\"take a test\",\"test result\"]]]";
        testParseLanguageFrom(json);
    }

    private void testParseLanguageFrom(String json) throws Exception {
        List list = readJson(json);
        Language.Code expected = Language.Code.EN;

        Language.Code languageFrom = parse(list);

        assertThat(languageFrom).isEqualTo(expected);
    }

    @Test(expected = NoSuchLanguageException.class)
    public void testParseLanguageFromWhenNoSuchLanguage() throws Exception {
        String json = "[[[\"Prüfung\",\"exam\",null,null,1]],[[\"noun\",[\"Prüfung\",\"Examen\",\"Klausur\"],[[\"Prüfung\",[\"examination\",\"test\",\"audit\",\"testing\",\"check\",\"exam\"],null,0.35656098,\"die\",2],[\"Examen\",[\"exam\",\"examination\",\"finals\"],null,0.021413151,\"das\",3],[\"Klausur\",[\"exam\",\"enclosure\",\"cloister\",\"seclusion\",\"conclave\",\"paper\"],null,0.0089263292,\"die\",2]],\"exam\",1]],\"noSuchLanguage\"]";
        List list = readJson(json);

        parse(list);
    }
}